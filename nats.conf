# NATS Server Configuration for Constellation
# This configuration is used when running NATS as a standalone service
# The embedded NATS service in the microlith uses programmatic configuration

# Server identification
server_name: "mothership-constellation"

# Network
port: 4222
http_port: 8222

# Jetstream 
jetstream {
  domain: "constellation"
  store_dir: "./data/mothership"
  
  # Memory and file storage limits
  max_memory_store: 64MB
  max_file_store: 1GB
  
  # Duplicate tracking window for idempotency
  duplicate_window: "2m"
}

# Logging
debug: false
trace: false
log_file: "./logs/mothership.log"

# Connection limits
max_connections: 1000
max_payload: 1MB

# Authorization (basic setup - enhance for production)
authorization {
  default_permissions {
    publish = ["constellation.>"]
    subscribe = ["constellation.>"]
  }
}

# System account for monitoring
system_account: SYS

accounts {
  SYS {
    users = [
      { user: sys, pass: changeme }
    ]
  }
  
  # Default account for constellation services
  CONSTELLATION {
    jetstream: enabled
    users = [
      { user: constellation, pass: changeme }
    ]
    
    # Stream exports for cross-account messaging if needed
    exports = [
      { stream: "constellation.entities.>" }
      { stream: "constellation.events.>" }
      { stream: "constellation.telemetry.>" }
      { stream: "constellation.commands.>" }
    ]
  }
}

# TLS Configuration (disabled by default, enable for production)
# tls {
#   cert_file: "./certs/server-cert.pem"
#   key_file:  "./certs/server-key.pem"
#   ca_file:   "./certs/ca.pem"
#   verify:    true
#   timeout:   2
# }

# Clustering configuration (for multi-node setup)
# cluster {
#   name: "constellation-cluster"
#   listen: localhost:6222
#   
#   routes = [
#     nats://localhost:6222
#   ]
# }

# Monitoring
monitoring {
  http_port: 8223
  https_port: 8224
}

# Limits
limits {
  max_connections: 1000
  max_subscriptions: 0
  max_payload: 1MB
  max_pending: 64MB
  max_control_line: 4KB
  
  # Write deadline
  write_deadline: "10s"
}

# Ping settings
ping_interval: "2m"
ping_max: 3

# Write deadline
write_deadline: "10s"